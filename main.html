

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Wheat Farm Tracker ‚Äî Session</title>
<style>
  :root{--bg:#f6f8fa;--card:#fff;--accent:#2b7cff;--muted:#6b7280}
  body{font-family:Inter,system-ui,Arial; margin:0;background:var(--bg); color:#111;-webkit-font-smoothing:antialiased}
  header{background:linear-gradient(90deg,#0b63ff33,#0bffb833);padding:16px;}
  header h1{margin:0;font-size:24px}
  .container{max-width:980px;margin:14px auto;padding:15px}
  .card{background:var(--card);border-radius:12px;padding:16px;margin-bottom:12px;box-shadow:0 6px 16px rgba(10,20,40,0.06)}
  label{display:block;font-size:15px;color:var(--muted);margin-top:10px}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .col{flex:1;color: #1e3a8a;font-size: 19px;min-width:140px}
 input[type=text],
input[type=number],
select,
textarea {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #d1d5db; /* light gray border */
  margin-top: 8px;
  box-sizing: border-box;
  font-size: 17px;
  background: #fff;
  transition: border-color 0.2s, box-shadow 0.2s;
}

input[type=text]:focus,
input[type=number]:focus,
select:focus,
textarea:focus {
  border-color: #3b82f6; /* blue accent on focus */
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
  outline: none;
}

  .section-title{font-weight:800;margin-top:6px;font-size: 19px;color: #1e3a8a;margin-bottom:6px}
  .btn{display:inline-flex;gap:8px;align-items:center;padding:12px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
  .btn-primary{background:var(--accent);color:#fff}
  .btn-ghost{background:transparent;border:1px solid #e6e9ef}
  .btn-warn{background:#ffc107;color:#000}
  .muted{color:var(--muted);font-size:15px}
  .chem-box{background:#fbfdff;border-radius:8px;padding:15px;margin-top:8px;border:1px dashed #e6eefc}
  .chem-row{display:flex;gap:8px;margin-top:6px;align-items:center}
  .small{font-size:13px}
  .list-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:#fafbff;margin-top:8px}
  .actions button{margin-left:8px}
  .summary{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .chip{background:#f1f6ff;border-radius:8px;padding:8px 10px;font-weight:600}
  .tabs{display:flex;gap:8px;margin-bottom:8px}
  .tab{padding:11px 12px;border-radius:8px;cursor:pointer;border:1px solid #e9eef7;background:#fff}
  .tab.active{background:var(--accent);color:#fff}
  footer{font-size:15px;color:var(--muted);text-align:center;padding:10px}
  .small-muted{font-size:15px;color:#6b7280;margin-top:6px}
  .inline-small{font-size:15px;padding:6px 8px;border-radius:6px}
  .danger{background:#ff4d4f;color:#fff}
  .hidden{display:none}
  .year-row{display:flex;justify-content:space-between;align-items:center;padding:13px;background:#f1f5f9;border-radius:8px;margin-top:8px;cursor:pointer}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{border:1px solid #e6eef7;padding:9px;text-align:left;font-size:15px}
  pre {white-space:pre-wrap; word-break:break-word; font-family:monospace; font-size:15px; background:#f8fafc;padding:10px;border-radius:6px}
  @media (max-width:640px){ .row{flex-direction:column} .col{min-width:unset} }
</style>
</head>
<body>
<header>
  <h1>üåæ Wheat Farm Tracker ‚Äî local (session)</h1>
  <div class="muted">Saves to <strong>sessionStorage</strong>Export/import to keep data longer.</div>
</header>

<div class="container">
  <div class="card" id="formCard">
    <div style="display:flex;justify-content:space-between;color: #1e3a8a;font-size: 19px;align-items:center">
      <strong>New / Edit Record</strong>
      <div class="small muted">Status: <span id="recordStatus">Draft</span></div>
    </div>

    <div style="margin-top:10px" class="row">
      <div class="col">
        <label>Year</label>
        <input id="year" type="number" inputmode="numeric" />
      </div>
      <div class="col">
        <label>Acreage (acres)</label>
        <input id="acres" type="number" step="0.01" />
      </div>
      <div class="col">
        <label>Notes (optional)</label>
        <input id="notes" type="text" placeholder="e.g., field name or location" />
      </div>
    </div>

    <!-- Land preparation -->
    <div class="section-title">Land preparation <span class="small-muted">‚Äî add multiple items</span></div>
    <div id="landPrepList"></div>
    <div style="margin-top:6px; border: 1px solid #000; margin: 20px 0;font-size: 16px;border-radius: 8px;">

      <button id="addLandPrep" class="btn btn-ghost">+ Add Land preparation item</button>
    </div>

    <!-- Seed -->
    <div class="section-title">Seed</div>
    <div id="seedList"></div>
    <div style="margin-top:6px; border: 1px solid #000; margin: 20px 0;font-size: 16px;border-radius: 8px;">

      <button id="addSeed" class="btn btn-ghost">+ Add Seed entry</button>
      <div class="small-muted">Seed entries: seed type, price per bag, bags per acre (rate)</div>
    </div>

    <!-- Fertilizer -->
    <div class="section-title">Fertilizer</div>
    <div id="fertList"></div>
   <div style="margin-top:6px; border: 1px solid #000; margin: 20px 0;font-size: 16px;border-radius: 8px;">


      <button id="addFert" class="btn btn-ghost">+ Add Fertilizer entry</button>
      <div class="small-muted">Fertilizer entries: type, cost per acre or per bag, rate</div>
    </div>
<input type="hidden" id="draftId" value="">

    <!-- Labour -->
    <div class="section-title">Labour</div>
    <div id="labourList"></div>
    <div style="margin-top:6px; border: 1px solid #000; margin: 20px 0;font-size: 16px;border-radius: 8px;">

      <button id="addLabour" class="btn btn-ghost">+ Add Labour item</button>
      <div class="small-muted">e.g., planting labour cost per acre, weeding labour per acre, etc.</div>
    </div>

    <!-- Weeding chemicals -->
    <div class="section-title">Weeding Chemicals</div>
    <div id="weedingList"></div>
    <div style="margin-top:6px; border: 1px solid #000; margin: 20px 0;font-size: 16px;border-radius: 8px;">


      <button id="addWeed" class="btn btn-ghost">+ Add Weeding Chemical</button>
      <div class="small-muted">Each chemical has name, price and labour cost per acre</div>
    </div>

    <!-- Boosting chemicals -->
    <div class="section-title">Boosting Chemicals</div>
    <div id="boostList"></div>
    <div style="margin-top:6px; border: 1px solid #000; margin: 20px 0;font-size: 16px;border-radius: 8px;">

      <button id="addBoost" class="btn btn-ghost">+ Add Boosting Chemical</button>
      <div class="small-muted">Growth boosters or foliar sprays</div>
    </div>

    <!-- Harvest & output -->
    <div class="section-title">Harvest & Output</div>
    <div class="row">
      <div class="col">
        <label>Harvesting cost per acre</label>
        <input id="harvestCost" type="number" step="0.01" />
      </div>
      <div class="col">
        <label>Bags yield per acre</label>
        <input id="bagsPerAcre" type="number" step="0.01" />
      </div>
      <div class="col">
        <label>Price per bag</label>
        <input id="pricePerBag" type="number" step="0.01" />
      </div>
    </div>

    <div style="margin-top:14px;display:flex;gap:8px;flex-wrap:wrap">
      <button id="saveDraft" class="btn btn-warn">üíæ Save Draft</button>
      <button id="saveFinal" class="btn btn-primary">‚úÖ Save Final</button>
      <button id="calcBtn" class="btn btn-ghost">üìä Calculate</button>
      <button id="clearForm" class="btn btn-ghost">Clear Form</button>
    </div>

    <div id="calcResult" class="summary" style="margin-top:12px"></div>
  </div>
<!-- somewhere in your HTML -->
<div id="mainPage">
  <!-- your main table or form goes here -->
</div>


<!-- Popup Overlay -->
<div id="recordModal" style="
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.6);
  z-index:1000;
  justify-content:center;
  align-items:center;
">
  <div style="
    background:#fff;
    padding:20px;
    max-width:800px;
    width:90%;
    max-height:90%;
    overflow:auto;
    border-radius:8px;
  ">
    <button id="closeModalBtn" class="btn btn-ghost" style="float:right;">‚úñ</button>
    <div id="modalContent"></div>
  </div>
</div>

  <!-- RECORDS -->
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Records</strong>
      <div>
        <button id="showDraftsBtn" class="tab active">Drafts</button>
        <button id="showFinalBtn" class="tab">Saved</button>
      </div>
    </div>

    <div id="listArea" style="margin-top:10px"></div>

    <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
      <button id="exportAll" class="btn btn-primary">Export All (JSON)</button>
      <input id="importFile" type="file" accept="application/json" style="display:none" />
      <button id="importBtn" class="btn btn-ghost">Import JSON</button>
      <button id="clearAll" class="btn danger">Clear All</button>
    </div>

    <div class="small-muted" style="margin-top:8px">Optimized for precision agriculture.</div>
  </div>

  <footer>Made with ‚ù§Ô∏è By John Ngugi</footer>
</div>

<script>
  /* ==========================
   IndexedDB Setup
========================== */
const DB_NAME = "FarmingAppDB";
const DB_VERSION = 1;
let db;

function initDB() {
  return new Promise((resolve, reject) => {
    const request = indexedDB.open(DB_NAME, DB_VERSION);

    request.onupgradeneeded = (e) => {
      db = e.target.result;
      if (!db.objectStoreNames.contains("drafts")) {
        db.createObjectStore("drafts", { keyPath: "id", autoIncrement: true });
      }
      if (!db.objectStoreNames.contains("saved")) {
        db.createObjectStore("saved", { keyPath: "id", autoIncrement: true });
      }
    };

    request.onsuccess = (e) => {
      db = e.target.result;
      resolve();
    };

    request.onerror = (e) => reject(e.target.error);
  });
}

function saveItem(storeName, item) {
  return new Promise((resolve, reject) => {
    const tx = db.transaction(storeName, "readwrite");
    tx.objectStore(storeName).put(item);
    tx.oncomplete = () => resolve();
    tx.onerror = (e) => reject(e.target.error);
  });
}

function getItem(storeName, id) {
  return new Promise((resolve, reject) => {
    const tx = db.transaction(storeName, "readonly");
    const request = tx.objectStore(storeName).get(Number(id));
    request.onsuccess = () => resolve(request.result);
    request.onerror = (e) => reject(e.target.error);
  });
}

function getAllItems(storeName) {
  return new Promise((resolve, reject) => {
    const tx = db.transaction(storeName, "readonly");
    const request = tx.objectStore(storeName).getAll();
    request.onsuccess = () => resolve(request.result);
    request.onerror = (e) => reject(e.target.error);
  });
}

function deleteItem(storeName, id) {
  return new Promise((resolve, reject) => {
    const tx = db.transaction(storeName, "readwrite");
    tx.objectStore(storeName).delete(Number(id));
    tx.oncomplete = () => resolve();
    tx.onerror = (e) => reject(e.target.error);
  });
}

/* ==========================
   Form Handling
========================== */
document.getElementById("saveDraft").addEventListener("click", async () => {
  const data = collectFormData();
  if (!data) return;

  if (data.id) {
    await saveItem("drafts", data);
  } else {
    delete data.id;
    await saveItem("drafts", data);
  }

  clearForm();
  loadTable("drafts");
});

document.getElementById("saveFinal").addEventListener("click", async () => {
  const data = collectFormData();
  if (!data) return;

  if (data.id) {
    await saveItem("saved", data);
  } else {
    delete data.id;
    await saveItem("saved", data);
  }

  clearForm();
  loadTable("saved");
});

function collectFormData() {
  return {
    id: document.getElementById("recordId").value
      ? Number(document.getElementById("recordId").value)
      : null,
    acres: document.getElementById("acres").value.trim(),
    notes: document.getElementById("notes").value.trim(),
    summary: document.getElementById("calcResult").innerText.trim()
  };
}

function clearForm() {
  document.getElementById("recordId").value = "";
  document.getElementById("acres").value = "";
  document.getElementById("notes").value = "";
  document.getElementById("calcResult").innerText = "";
}

/* ==========================
   Table Display
========================== */
async function loadTable(showing) {
  const container = document.getElementById("listArea");
  container.innerHTML = "";

  const table = document.createElement("table");
  table.className = "table";
  table.innerHTML = `
    <thead>
      <tr>
        <th>#</th>
        <th>Acres</th>
        <th>Notes</th>
        <th>Summary</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  `;

  const items = await getAllItems(showing);
  items.forEach((rec, idx) => {
    const row = document.createElement("tr");
    const actionsCell = document.createElement("td");

    // Edit Button
    const btnEdit = document.createElement("button");
    btnEdit.className = "btn btn-primary";
    btnEdit.textContent = "Edit";
    btnEdit.onclick = () => {
      editRecord(showing, rec.id);
      window.scrollTo({ top: 0, behavior: "smooth" });
    };
    actionsCell.appendChild(btnEdit);

    // Delete Button
    const btnDelete = document.createElement("button");
    btnDelete.className = "btn btn-danger";
    btnDelete.textContent = "Delete";
    btnDelete.onclick = async () => {
      await deleteItem(showing, rec.id);
      loadTable(showing);
    };
    actionsCell.appendChild(btnDelete);

    row.innerHTML = `
      <td>${idx + 1}</td>
      <td>${rec.acres || "‚Äî"}</td>
      <td>${rec.notes || "‚Äî"}</td>
      <td>${rec.summary || "‚Äî"}</td>
    `;
    row.appendChild(actionsCell);
    table.querySelector("tbody").appendChild(row);
  });

  container.appendChild(table);
}

/* ==========================
   Edit Record
========================== */
async function editRecord(storeName, id) {
  const record = await getItem(storeName, id);
  if (!record) {
    alert("Record not found.");
    return;
  }
  document.getElementById("recordId").value = id;
  document.getElementById("acres").value = record.acres || "";
  document.getElementById("notes").value = record.notes || "";
  document.getElementById("calcResult").innerText = record.summary || "";
}

/* ==========================
   Login
========================== */
const encodedUser = btoa("john_doe"); // generic username variable
const encodedPass = btoa("securepass2025");

document.getElementById("loginForm")?.addEventListener("submit", async function (e) {
  e.preventDefault();
  const username = document.getElementById("username").value.trim().toLowerCase();
  const password = document.getElementById("password").value.trim().toLowerCase();
  const errorMessage = document.getElementById("error-message");

  if (btoa(username) === encodedUser && btoa(password) === encodedPass) {
    sessionStorage.setItem("loggedIn", "true");
    await initDB();
    loadTable("drafts");
    window.location.href = "main.html";
  } else {
    errorMessage.innerText = "Invalid credentials.";
    setTimeout(() => (errorMessage.innerText = ""), 2000);
  }
});

/* ==========================
   On Load
========================== */
document.addEventListener("DOMContentLoaded", async () => {
  await initDB();
  if (sessionStorage.getItem("loggedIn") === "true") {
    loadTable("drafts");
  }
});

</script>
</body>
</html>
